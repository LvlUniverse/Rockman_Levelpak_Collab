<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>sprSiphonTopaz</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>prtPlayerProjectile</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>event_inherited();

bulletLimitCost = 1;

contactDamage = 2;

despawnRange = -1;

pierces = 2;    //hits repeatedly
attackDelay = 20;

yspeed = -5;
grav = 0.25;

animTimer = -1;

guardCancel = 0;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>event_inherited();

if (!global.frozen)
{
    //animate if necessary
    if animTimer != -1
        image_index = floor(animTimer++ / 5) mod 4;
    
    //doesn't despawn off the top
    if sign(grav) &gt; 0
    {
        if bbox_top &lt; view_yview &amp;&amp; !(bbox_left &gt; view_xview + view_wview || bbox_right &lt; view_xview)
            despawnRange = -1;
        else
            despawnRange = 4;
    }
    else    //i.e. if sign(grav) &lt;= 0
    {
        if bbox_bottom &gt; view_yview + view_hview &amp;&amp; !(bbox_left &gt; view_xview + view_wview || bbox_right &lt; view_xview)
            despawnRange = -1;
        else
            despawnRange = 4;
    }
    
    //everything else that's interesting happens in other events
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="24">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///while equipped...

var doFire = false;
if !global.autoFire
{   //normal fire
    doFire = global.keyShootPressed[playerID] &amp;&amp; !playerIsLocked(PL_LOCK_SHOOT) &amp;&amp; chargeTimer == 0;
}
else
{   //autofire
    if global.keyShoot[playerID] &amp;&amp; !playerIsLocked(PL_LOCK_SHOOT)
    {
        autoFireTimer++;
    }
    else
        autoFireTimer = 0;
    if autoFireTimer &gt;= 30
        autoFireTimer = 0;
    doFire = (autoFireTimer == 1) &amp;&amp; !(global.autoCharge &amp;&amp; chargeTimer &gt; 0);
}

//fire when shot
if (doFire &amp;&amp; !playerIsLocked(PL_LOCK_SHOOT))
{
    with (fireWeapon(19, 0, objSiphonTopaz, 2, 2, 2, 1))
    {
        xspeed = image_xscale;
        yspeed = -5 * image_yscale;
        grav = 0.25 * image_yscale;
        image_xscale = 1; //feels like the kind of weapon that wouldn't flip when it flips
        playSFX(sfxSiphonTopaz);
        //kill existing topazes
        with (objSiphonTopaz)
        {
            if id != other.id
                event_user(EV_REFLECTED);
        }
    }
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="22">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///weapon icon, name, colors
weaponSetup("SIPHON TOPAZ", 
    make_color_rgb(132, 112, 34), 
    make_color_rgb(232, 185, 82), 
    sprWeaponIconsSiphonTopaz, 3, 
        " You throw a large topaz in an arc. The topaz will bounce up and steal health when it hits an enemy.## After hitting an enemy, it powers up, dealing more damage and stealing more health.## This can be fired even if the shot limit has been reached.",
        "2 - 4#1#1#2");
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="18">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///bounce off of enemies, spawn health recovery

yspeed = -5 * image_yscale;    //go up

if animTimer == -1   //increase in power after first bounce
{
    contactDamage = 4;
    animTimer = 0;
    mask_index = mskSiphonTopazCharged;
}

if global.damage &gt; 0    //recover health
{
    with(instance_create(x, y + (10 * image_yscale), objSiphonTopazPickup))
    {
        parent = other.parent;
        hlth = global.damage;
        if hlth &gt;= 4
            sprite_index = sprSiphonTopazPickupM;
        speed = 0.8;
        direction = 180 * (sign(grav) == 1);
    }
    if instance_exists(parent)  //drain weapon energy for each hit
    {
        var wid = global.weaponID[? objSiphonTopaz]
        global.ammo[playerID, wid] 
            = max(global.ammo[playerID, wid] - (1 / (global.energySaver + 1)), 0);
    }
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="17">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///crumble when deflected

//kill existing crumble effects to mitigate sprite flicker
with(objTopazDebris)
    instance_destroy();

//spawn new crumble effects
for (var p = 4; p &lt;= 6; p++)
{
    with instance_create(x, y, objTopazDebris)
    {
        image_index = p;
        xspeed = (p - 4.7) / 2; //slightly biased to the right
        if other.image_yscale &lt; 0
        {
            yspeed = 2;
            grav = -grav;
            image_yscale = -1;
        }
        if p == 5
            yspeed = -1 * image_yscale;
    }
}

//play sound, depending on if this was caused by a deflection or not
if guardCancel != 0 &amp;&amp; guardCancel != 2
    playSFX(sfxReflect);
else
    playSFX(sfxSiphonTopazShatter);

//die
instance_destroy();
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
